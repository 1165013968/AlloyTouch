<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
</head>
<body style="background-color: black;">
    <script src="../transform.min.js" ></script>
    <script>


    (function() {
        var imgArr = [];
        var centreOfCirclePosition = {x: 300, y: 300, z: 0};
        var cameraPosition = {x: 300, y: 300, z: 400};
        var r = 250;
        var distance = 300;
        var starPositions = [],
                starPositionsForShow = [],
                currentAngle = Math.PI / 60;

        function randomPoints() {
            var xTemp;
            var yTemp;
            var zTemp;
            var i;
            var j = -1;
            /** @type {number} */
            i = 0;
            for (; i < 440; i++) {
                xTemp = getRandomNumber(-250, 250);
                yTemp = getRandomNumber(-250, 250);
                j *= -1;
                if (xTemp * xTemp + yTemp * yTemp <= r * r) {
                    /** @type {number} */
                    zTemp = j * Math.sqrt(Math.abs(r * r - xTemp * xTemp - yTemp * yTemp));
                    starPositions.push({x: xTemp, y: yTemp, z: zTemp});
                }
            }
        }

        function getRandomNumber(min, max) {
            return min + Math.floor(Math.random() * (max - min + 1));
        }

        /**
         * @return {undefined}
         */
        function positionsProjection() {
            var copies;
            /** @type {number} */
            var conditionIndex = 0;
            for (; conditionIndex < starPositions.length; conditionIndex++) {
                copies = projection(starPositions[conditionIndex]);
                starPositionsForShow.push(copies);
            }
        }

        function degToRad(degrees) {
            return degrees / (180 / Math.PI);
        }

        /**
         * @param {?} rot
         * @return {undefined}
         */
        function rotate(rot) {
            var cx;
            var z;
            /** @type {number} */
            var n1 = 0;
            for (; n1 < starPositions.length; n1++) {
                cx = starPositions[n1].x;
                z = starPositions[n1].z;
                /** @type {number} */
                starPositions[n1].x = starPositions[n1].x * Math.cos(rot) - starPositions[n1].z * Math.sin(rot);
                /** @type {number} */
                starPositions[n1].z = starPositions[n1].z * Math.cos(rot) + cx * Math.sin(rot);
            }
        }

        function projection(pos3d) {

            return {
                x: pos3d.x * distance / Math.abs(cameraPosition.z - pos3d.z),
                y: pos3d.y * distance / Math.abs(cameraPosition.z - pos3d.z),
                z: pos3d.z
            };
        }


        function createImgs() {
            var i = 0,
                    len = starPositionsForShow.length;

            for (; i < len; i++) {
                var img = document.createElement("img");
                img.style.position = "absolute";
                img.style.left = "0px";
                img.style.top = "0px";
                img.src = "../asset/star.png";
                document.body.appendChild(img);
                Transform(img);
                img.translateX = centreOfCirclePosition.x + starPositionsForShow[i].x;
                img.translateY = centreOfCirclePosition.x + starPositionsForShow[i].y;
                /** @type {number} */
                img.scaleX = img.scaleY = 0.5 * distance / Math.abs(cameraPosition.z - starPositionsForShow[i].z);
                img.style.opacity = starPositionsForShow[i].z < 50 ? 0.5 : 1;

                imgArr.push(img);
            }
        }

        /**
         * @return {undefined}
         */
        function tick() {
            var i;
            /** @type {number} */
            starPositionsForShow.length = 0;
            rotate(degToRad(currentAngle));
            positionsProjection();
            /** @type {number} */
            i = 0;
            for (; i < starPositionsForShow.length; i++) {
                var img = imgArr[i];
                img.translateX = centreOfCirclePosition.x + starPositionsForShow[i].x;
                img.translateY = centreOfCirclePosition.x + starPositionsForShow[i].y;
                /** @type {number} */
                img.scaleX = img.scaleY = 0.5 * distance / Math.abs(cameraPosition.z - starPositionsForShow[i].z);
                img.style.opacity = starPositionsForShow[i].z < 50 ? 0.5 : 1;
            }
            requestAnimationFrame(tick);
        }

        (function () {
            randomPoints();

            positionsProjection();
            createImgs();
            tick();
        })();

    })()




    </script>
    <a href="https://github.com/AlloyTeam/AlloyTouch/tree/master/transformjs" target="_blank" style="position: absolute; right: 0; top: 0;">
        <img src="http://alloyteam.github.io/AlloyGameEngine/AlloyPaper/example/asset/img/github.png" alt="" />
    </a>
</body>
</html>