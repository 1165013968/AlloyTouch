<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
</head>
<body style="background-color: black;">
    <script src="../transform.min.js" ></script>
    <script>

        var img_list = [],
         center = {x: 300, y: 300, z: 0},
         camera_position = {x: 300, y: 300, z: 400},
         r = 250,
         distance = 300,
         positions = [],
         rd_positions = [],
         step_angle =  Math.PI/180,
         size=400;

        function randomPoints() {
            var xTemp;
            var yTemp;
            var zTemp;
            var i;
            var j = -1;
            i = 0;
            for (; i < size; i++) {
                xTemp = getRandomNumber(-250, 250);
                yTemp = getRandomNumber(-250, 250);
                j *= -1;
                if (xTemp * xTemp + yTemp * yTemp <= r * r) {
                    zTemp = j * Math.sqrt(Math.abs(r * r - xTemp * xTemp - yTemp * yTemp));
                    positions.push({x: xTemp, y: yTemp, z: zTemp});
                    rd_positions.push({x: xTemp, y: yTemp, z: zTemp});
                }
            }
        }

        function getRandomNumber(min, max) {
            return min + Math.floor(Math.random() * (max - min + 1));
        }

        function positionsProjection() {

            var index = 0,
                    len=positions.length;
            for (; index < len; index++) {
                var p = positions[index];
                var rp = rd_positions[index];
                //projection
                rp.x = p.x * distance / Math.abs(camera_position.z - p.z);
                rp.y =  p.y * distance / Math.abs(camera_position.z - p.z);

            }
        }

        function rotate() {
            var cx,
                    z,
                    i = 0,
                    len=positions.length;
            for (; i < len; i++) {
                cx = positions[i].x;
                z = positions[i].z;
                positions[i].x = positions[i].x * Math.cos(step_angle) - positions[i].z * Math.sin(step_angle);
                positions[i].z = positions[i].z * Math.cos(step_angle) + cx * Math.sin(step_angle);
            }
        }

        function createImgs() {
            var i = 0,
                len = rd_positions.length;

            for (; i < len; i++) {
                var img = document.createElement("img");
                img.style.position = "absolute";
                img.style.left = "0px";
                img.style.top = "0px";
                img.src = "../asset/star.png";
                document.body.appendChild(img);
                Transform(img);

                transformImg(img,i);

                img_list.push(img);
            }
        }

        function transformImg(img, i) {
            var z = positions[i].z;
            img.translateX = center.x + rd_positions[i].x;
            img.translateY = center.x + rd_positions[i].y;
            img.scaleX = img.scaleY = 0.5 * distance / Math.abs(camera_position.z - z);
            img.style.opacity = 1 - (r - z) / (2 * r);
        }

        function render(){
            var i = 0,
                len=rd_positions.length;
            for (; i < len; i++) {
                transformImg(img_list[i],i);
            }
        }

        function tick() {
            rotate();
            positionsProjection();
            render();
            requestAnimationFrame(tick);
        }

        (function () {
            randomPoints();

            positionsProjection();
            createImgs();
            tick();
        })();




    </script>
    <a href="https://github.com/AlloyTeam/AlloyTouch/tree/master/transformjs" target="_blank" style="position: absolute; right: 0; top: 0;">
        <img src="http://alloyteam.github.io/AlloyGameEngine/AlloyPaper/example/asset/img/github.png" alt="" />
    </a>
</body>
</html>