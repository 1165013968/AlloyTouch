<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
</head>
<body style="background-color: black;">
    <script src="../transform.min.js" ></script>
    <script>

        var img_list = [];
        var center = {x: 300, y: 300, z: 0};
        var camera_position = {x: 300, y: 300, z: 400};
        var r = 250;
        var distance = 300;
        var positions = [],
                rd_positions = [],
                step_angle =  1,
                size=400;

        function randomPoints() {
            var xTemp;
            var yTemp;
            var zTemp;
            var i;
            var j = -1;
            i = 0;
            for (; i < size; i++) {
                xTemp = getRandomNumber(-250, 250);
                yTemp = getRandomNumber(-250, 250);
                j *= -1;
                if (xTemp * xTemp + yTemp * yTemp <= r * r) {
                    zTemp = j * Math.sqrt(Math.abs(r * r - xTemp * xTemp - yTemp * yTemp));
                    positions.push({x: xTemp, y: yTemp, z: zTemp});
                    rd_positions.push({x: xTemp, y: yTemp, z: zTemp});
                }
            }
        }

        function getRandomNumber(min, max) {
            return min + Math.floor(Math.random() * (max - min + 1));
        }

        function positionsProjection() {

            var index = 0,
                    len=positions.length;
            for (; index < len; index++) {
                var p = positions[index];
                var rp = rd_positions[index];
                //projection
                rp.x = p.x * distance / Math.abs(camera_position.z - p.z);
                rp.y =  p.y * distance / Math.abs(camera_position.z - p.z);

            }
        }

        function rotate() {
            var ag = step_angle * Math.PI / 180;
            var cx;
            var z;
            var n1 = 0;
            for (; n1 < positions.length; n1++) {
                cx = positions[n1].x;
                z = positions[n1].z;
                positions[n1].x = positions[n1].x * Math.cos(ag) - positions[n1].z * Math.sin(ag);
                positions[n1].z = positions[n1].z * Math.cos(ag) + cx * Math.sin(ag);
            }
        }

        function createImgs() {
            var i = 0,
                len = rd_positions.length;

            for (; i < len; i++) {
                var img = document.createElement("img");
                img.style.position = "absolute";
                img.style.left = "0px";
                img.style.top = "0px";
                img.src = "../asset/star.png";
                document.body.appendChild(img);
                Transform(img);
                img.translateX = center.x + rd_positions[i].x;
                img.translateY = center.x + rd_positions[i].y;
                img.scaleX = img.scaleY = 0.5 * distance / Math.abs(camera_position.z - rd_positions[i].z);
                img.style.opacity = rd_positions[i].z < 50 ? 0.5 : 1;

                img_list.push(img);
            }
        }

        function tick() {

            rotate();
            positionsProjection();

            var i = 0,
                    len=rd_positions.length;
            for (; i < len; i++) {
                var img = img_list[i];
                img.translateX = center.x + rd_positions[i].x;
                img.translateY = center.x + rd_positions[i].y;
                img.scaleX = img.scaleY = 0.5 * distance / Math.abs(camera_position.z - rd_positions[i].z);
                img.style.opacity = rd_positions[i].z < 50 ? 0.5 : 1;
            }
            requestAnimationFrame(tick);
        }

        (function () {
            randomPoints();

            positionsProjection();
            createImgs();
            tick();
        })();




    </script>
    <a href="https://github.com/AlloyTeam/AlloyTouch/tree/master/transformjs" target="_blank" style="position: absolute; right: 0; top: 0;">
        <img src="http://alloyteam.github.io/AlloyGameEngine/AlloyPaper/example/asset/img/github.png" alt="" />
    </a>
</body>
</html>